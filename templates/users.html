{% extends "base.html" %}
{% set active='users' %}
{% block content %}
  <h1>Users</h1>
  <section class="card">
    <form method="post" action="{{ url_for('users_admin') }}" style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr auto;gap:8px;align-items:end">
      <input type="hidden" name="_csrf" value="{{ csrf_token() if csrf_token is defined else '' }}">
      <div><label>Username</label><input name="username" required /></div>
      <div><label>Email</label><input name="email" required /></div>
      <div><label>Position</label><input name="position" /></div>
      <div><label>Role</label>
        <select name="role"><option>viewer</option><option>editor</option><option>admin</option></select>
      </div>
      <div><button class="btn btn-primary" type="submit">Create</button></div>
    </form>
  </section>
  <section class="card" style="margin-top:12px">
    <table class="table">
      <thead><tr><th>Username</th><th>Email</th><th>Position</th><th>Role</th><th>Actions</th></tr></thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td class="mono">{{ u.username }}</td>
          <td class="mono">{{ u.email }}</td>
          <td>{{ u.position or '' }}</td>
          <td>{{ u.role }}</td>
          <td style="display:flex;gap:8px">
            {% if current_user.id != u.id %}
              <form method="post" action="{{ url_for('user_delete', user_id=u.id) }}" onsubmit="return confirm('Delete user?')">
                <input type="hidden" name="_csrf" value="{{ csrf_token() if csrf_token is defined else '' }}">
                <button class="btn" type="submit">Delete</button>
              </form>
            {% endif %}
            <a class="btn" href="{{ url_for('user_edit', user_id=u.id) }}">Edit</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
{% endblock %}